const prisma = require("../../../config/prisma");
const bcrypt = require("bcrypt");

////////////////////////////////////////////////////////////
/// CREATE RECRUITER (ADMIN ONLY)
////////////////////////////////////////////////////////////

async function createRecruiter({ name, email, password }) {
  ////////////////////////////////////////////////////////////
  // NORMALIZE EMAIL
  ////////////////////////////////////////////////////////////

  email = email.toLowerCase().trim();

  ////////////////////////////////////////////////////////////
  // CHECK IF USER EXISTS
  ////////////////////////////////////////////////////////////

  const existingUser = await prisma.user.findUnique({
    where: { email },
  });

  if (existingUser) {
    throw new Error("Email already registered");
  }

  ////////////////////////////////////////////////////////////
  // HASH PASSWORD
  ////////////////////////////////////////////////////////////

  const hashedPassword = await bcrypt.hash(password, 10);

  ////////////////////////////////////////////////////////////
  // CREATE RECRUITER
  ////////////////////////////////////////////////////////////

  const recruiter = await prisma.user.create({
    data: {
      name: name.trim(),
      email,
      password: hashedPassword,
      role: "RECRUITER",
    },

    select: {
      id: true,
      name: true,
      email: true,
      role: true,
      createdAt: true,
    },
  });

  return recruiter;
}

////////////////////////////////////////////////////////////

module.exports = {
  createRecruiter,
};