generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

////////////////////////////////////////////////////////////
/// USER
////////////////////////////////////////////////////////////

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      Role     @default(USER)
  createdAt DateTime @default(now())

  createdJobs Job[] @relation("UserJobs")

  partner Partner?

  applications Application[] @relation("UserApplications")
}

////////////////////////////////////////////////////////////
/// JOB
////////////////////////////////////////////////////////////

model Job {
  id String @id @default(uuid())

  // Core fields
  jrCode      String? @unique
  title       String
  description String?
  department  String?
  companyName String?
  location    String?

  // Experience
  minExperience Int?
  maxExperience Int?

  // Salary
  salaryMin Int?
  salaryMax Int?

  // Hiring info
  openings  Int?
  skills    String?
  education String?

  // Client tracking
  clientName    String?
  clientContact String?
  clientEmail   String?

  // Job lifecycle
  status      JobStatus @default(OPEN)
  requestDate DateTime?
  closureDate DateTime?

  // Analytics optimization
  applicationsCount Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  createdById String
  createdBy   User   @relation("UserJobs", fields: [createdById], references: [id])

  applications Application[]

  @@index([status])
}

enum JobStatus {
  OPEN
  CLOSED
  ON_HOLD
  CANCELLED
}

////////////////////////////////////////////////////////////
/// CANDIDATE
////////////////////////////////////////////////////////////

model Candidate {
  id String @id @default(uuid())

  // Basic identity
  name  String
  email String
  phone String

  // Location info
  currentLocation    String?
  preferredLocations String?
  hometown           String?
  pincode            String?

  // Professional info
  totalExperience    Float?
  currentCompany     String?
  currentDesignation String?
  department         String?
  industry           String?
  skills             String?
  currentSalary      Float?
  expectedSalary     Float?
  noticePeriodDays   Int?

  // Education info
  highestQualification String?
  specialization       String?
  university           String?
  graduationYear       Int?

  // Personal info
  dateOfBirth   DateTime?
  gender        String?
  maritalStatus String?

  // Source tracking
  createdByUserId    String?
  createdByPartnerId String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  applications Application[]

  @@unique([email, phone])
  // Indexes and constraints
  @@index([email])
  @@index([phone])
}

////////////////////////////////////////////////////////////
/// APPLICATION (CORE PIPELINE ENTITY)
////////////////////////////////////////////////////////////

model Application {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  jobId String
  job   Job    @relation(fields: [jobId], references: [id])

  candidateId String
  candidate   Candidate @relation(fields: [candidateId], references: [id])

  appliedByUserId String?
  appliedByUser   User?   @relation("UserApplications", fields: [appliedByUserId], references: [id])

  appliedByPartnerId String?
  appliedByPartner   Partner? @relation("PartnerApplications", fields: [appliedByPartnerId], references: [id])

  pipelineStage ApplicationStage        @default(APPLIED)
  finalStatus   ApplicationFinalStatus?

  source          String?
  notes           String?
  rejectionReason String?

  contactedAt          DateTime?
  interviewScheduledAt DateTime?
  interviewCompletedAt DateTime?
  offerSentAt          DateTime?
  offerAcceptedAt      DateTime?
  offerRejectedAt      DateTime?
  hiredAt              DateTime?
  rejectedAt           DateTime?

  @@unique([candidateId, jobId])
  @@index([jobId])
  @@index([candidateId])
  @@index([pipelineStage])
  @@index([finalStatus])
  @@index([appliedByUserId])
  @@index([appliedByPartnerId])
}

enum ApplicationStage {
  APPLIED
  SCREENING
  CONTACTED
  DOCUMENT_REQUESTED
  DOCUMENT_RECEIVED
  SUBMITTED_TO_CLIENT
  INTERVIEW_SCHEDULED
  INTERVIEW_COMPLETED
  SHORTLISTED
  OFFER_SENT
  OFFER_ACCEPTED
  OFFER_REJECTED
  HIRED
  REJECTED
}

enum ApplicationFinalStatus {
  HIRED
  REJECTED
  WITHDRAWN
}

////////////////////////////////////////////////////////////
/// PARTNER
////////////////////////////////////////////////////////////

model Partner {
  id String @id @default(uuid())

  organisationName  String
  ownerName         String
  establishmentDate DateTime

  gstNumber String
  panNumber String

  msmeRegistered Boolean @default(false)

  address       String
  contactNumber String
  officialEmail String

  status PartnerStatus @default(PENDING)

  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())

  applications Application[] @relation("PartnerApplications")
}

enum PartnerStatus {
  PENDING
  APPROVED
  REJECTED
}

////////////////////////////////////////////////////////////
/// ROLE
////////////////////////////////////////////////////////////

enum Role {
  ADMIN
  RECRUITER
  PARTNER
  USER
}
